
        <!DOCTYPE html>
        <html lang="ru" dir="ltr">
            <head>
                <meta charset="utf-8">
                
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Отношение многие ко многим | django-web-api</title>
                <style type="text/css">
                    body {
                        height: 100vh;
                    }
                </style>
                <link type="text/css" rel="stylesheet" href="../../../_bundle/vendor.css" />
<link type="text/css" rel="stylesheet" href="../../../_bundle/app.css" />
                
                
            </head>
            <body class="g-root g-root_theme_light">
                <div id="root"></div>
                <script type="application/javascript">
                   window.STATIC_CONTENT = false
                   window.__DATA__ = {"data":{"leading":false,"toc":{"title":"django-web-api","href":"../../../index.html","items":[{"name":"Введение в курс","href":"../../../course.html","id":"Введение в курс-0-0.21328434324150303"},{"name":"Основы ORM в Django","items":[{"name":"Введение в курс","href":"../../../Основы ORM в Django/section.html","id":"Введение в курс-0-0.613971568205776"},{"name":"ORM модели","items":[{"name":"Введение в модели Django","href":"../../../Основы ORM в Django/ORM модели/Введение в модели Django/task.html","id":"Введение в модели Django-0-0.8576999051437224"},{"name":"Работа с миграциями данных","href":"../../../Основы ORM в Django/ORM модели/Работа с миграциями данных/task.html","id":"Работа с миграциями данных-1-0.35085460165403437"},{"name":"Хорошие практики по работе с миграциями","href":"../../../Основы ORM в Django/ORM модели/Хорошие практики по работе с миграциями/task.html","id":"Хорошие практики по работе с миграциями-2-0.6731791710892208"},{"name":"Основные типы полей и их особенности","href":"../../../Основы ORM в Django/ORM модели/Основные типы полей и их особенности/task.html","id":"Основные типы полей и их особенности-3-0.46209639488264176"},{"name":"Добавление данных через фикстуры","href":"../../../Основы ORM в Django/ORM модели/Добавление данных через фикстуры/task.html","id":"Добавление данных через фикстуры-4-0.7540279753031631"}],"id":"ORM модели-1-0.05363338033877163"},{"name":"CRUD операции","items":[{"name":"Чтение данных","href":"../../../Основы ORM в Django/CRUD операции/Чтение данных/task.html","id":"Чтение данных-0-0.9311668095990631"},{"name":"Создание и обновление объектов","href":"../../../Основы ORM в Django/CRUD операции/Создание и обновление объектов/task.html","id":"Создание и обновление объектов-1-0.22110356017425037"},{"name":"Удаление объектов","href":"../../../Основы ORM в Django/CRUD операции/Удаление объектов/task.html","id":"Удаление объектов-2-0.5104462301064618"}],"id":"CRUD операции-2-0.6528166791129126"},{"name":"Работа с админкой","items":[{"name":"Основы работы с админкой","href":"../../../Основы ORM в Django/Работа с админкой/Основы работы с админкой/task.html","id":"Основы работы с админкой-0-0.4227691693456568"},{"name":"Настройка отображения экземпляров моделей в админ панели","href":"../../../Основы ORM в Django/Работа с админкой/Настройка отображения экземпляров моделей в админ панели/task.html","id":"Настройка отображения экземпляров моделей в админ панели-1-0.3960065301341391"},{"name":"Основы работы с админкой","href":"../../../Основы ORM в Django/Работа с админкой/Дополнительные настройки админки/task.html","id":"Основы работы с админкой-2-0.6271953181529664"}],"id":"Работа с админкой-3-0.2095258976464498"}],"id":"Основы ORM в Django-1-0.6482894777773658"},{"name":"Расширенные возможности ORM в Django","items":[{"name":"Введение в модуль","href":"../../../Расширенные возможности ORM в Django/section.html","id":"Введение в модуль-0-0.05859718235873168"},{"name":"Отладка запросов","items":[{"name":"Введение в модели Django","href":"../../../Расширенные возможности ORM в Django/Отладка запросов/Установка и настройка Debug Toolbar/task.html","id":"Введение в модели Django-0-0.3427194554742241"},{"name":"Работа с миграциями данных","href":"../../../Расширенные возможности ORM в Django/Отладка запросов/Практические примеры использования debugsqlshell/task.html","id":"Работа с миграциями данных-1-0.9791369249324455"}],"id":"Отладка запросов-1-0.825472889870994"},{"name":"Отношения между моделями","items":[{"name":"Отношение многие к одному","href":"../../../Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие к одному/task.html","id":"Отношение многие к одному-0-0.5549038812072882"},{"name":"Отношение один ко многим","href":"../../../Расширенные возможности ORM в Django/Отношения между моделями/Отношение один ко многим/task.html","id":"Отношение один ко многим-1-0.023002558049238564"},{"name":"Отношение многие ко многим","href":"../../../Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие ко многим/task.html","id":"Отношение многие ко многим-2-0.6125990260595662"}],"id":"Отношения между моделями-2-0.13169240853483566"},{"name":"Фильтрация и запросы с помощью Q-объектов","items":[{"name":"Фильтрация по полям модели и связанным моделям","href":"../../../Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Фильтрация по полям модели и связанным моделям/task.html","id":"Фильтрация по полям модели и связанным моделям-0-0.4923372153311314"},{"name":"Настройка отображения экземпляров моделей в админ панели","href":"../../../Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Использование Q-объектов для сложных запросов/task.html","id":"Настройка отображения экземпляров моделей в админ панели-1-0.41365057753857215"},{"name":"Основы работы с админкой","href":"../../../Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Группировка данных и агрегация/task.html","id":"Основы работы с админкой-2-0.01137031103632391"}],"id":"Фильтрация и запросы с помощью Q-объектов-3-0.029813999901744825"},{"name":"Оптимизация запросов","items":[{"name":"Подводные камни при работе с ORM запросами","href":"../../../Расширенные возможности ORM в Django/Оптимизация запросов/Подводные камни при работе с ORM запросами/task.html","id":"Подводные камни при работе с ORM запросами-0-0.5063791175745209"},{"name":"Выбор полей запроса","href":"../../../Расширенные возможности ORM в Django/Оптимизация запросов/Выбор полей запроса/task.html","id":"Выбор полей запроса-1-0.16480286861020343"},{"name":"Массовое создание и обновление","href":"../../../Расширенные возможности ORM в Django/Оптимизация запросов/Массовое создание и обновление/task.html","id":"Массовое создание и обновление-2-0.9624966820500871"}],"id":"Оптимизация запросов-4-0.47813133729817725"}],"id":"Расширенные возможности ORM в Django-2-0.968083786188108"}],"base":"."},"meta":{"metadata":[],"style":[],"script":[]},"assets":[],"headings":[{"title":"Цель урока","href":"#cel-uroka","level":2},{"title":"Понятие отношения многие ко многим","href":"#ponyatie-otnosheniya-mnogie-ko-mnogim","level":2,"items":[{"title":"Основы отношения многие ко многим","href":"#osnovy-otnosheniya-mnogie-ko-mnogim","level":3}]},{"title":"Работа с таблицей-связью","href":"#rabota-s-tablicej-svyazyu","level":2,"items":[{"title":"Автоматически создаваемые таблицы-связи","href":"#avtomaticheski-sozdavaemye-tablicy-svyazi","level":3},{"title":"Собственная модель связь","href":"#sobstvennaya-model-svyaz","level":3}]},{"title":"Работа со связями","href":"#rabota-so-svyazyami","level":2,"items":[{"title":"Добавление уже существующего объекта","href":"#dobavlenie-uzhe-sushestvuyushego-obuekta","level":3},{"title":"Создание нового объекта и его добавление","href":"#sozdanie-novogo-obuekta-i-ego-dobavlenie","level":3},{"title":"Удаление связей","href":"#udalenie-svyazej","level":3},{"title":"Обновление связей","href":"#obnovlenie-svyazej","level":3}]}],"title":"Отношение многие ко многим","includes":[],"html":"<h2 id=\"cel-uroka\"><a href=\"#cel-uroka\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Цель урока</span></a>Цель урока</h2>\n<p>В этом уроке вы узнаете, как реализовывается отношение многие ко многим в Django ORM. Вы изучите, что такое отношение многие ко многим, как его использовать для моделей в вашем веб-приложении и как управлять данными в таблице-связи. Вы поймете, как Django ORM автоматически генерирует промежуточную таблицу. А также как и когда создавать собственные промежуточные таблицы для настройки дополнительных параметров связи.</p>\n<h2 id=\"ponyatie-otnosheniya-mnogie-ko-mnogim\"><a href=\"#ponyatie-otnosheniya-mnogie-ko-mnogim\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Понятие отношения многие ко многим</span></a>Понятие отношения многие ко многим</h2>\n<p>Отношение многие ко многим следующим важным понятием в моделировании и организации данных, особенно в контексте реляционных баз данных и веб-разработки. Это отношение позволяет одному объекту быть связанным с множеством других объектов и наоборот.</p>\n<h3 id=\"osnovy-otnosheniya-mnogie-ko-mnogim\"><a href=\"#osnovy-otnosheniya-mnogie-ko-mnogim\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Основы отношения многие ко многим</span></a>Основы отношения многие ко многим</h3>\n<p>В реальной жизни примеры отношений многие ко многим встречаются повсеместно. Например:</p>\n<table>\n<thead>\n<tr>\n<th>Пример</th>\n<th>Модель 1</th>\n<th>Модель 2</th>\n<th>Описание связи</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1. Книги и Теги</td>\n<td>Книга</td>\n<td>Тег</td>\n<td>Одна книга может иметь множество тегов, и один тег может быть присвоен множеству книг.</td>\n</tr>\n<tr>\n<td>2. Студенты и Курсы</td>\n<td>Студент</td>\n<td>Курс</td>\n<td>Один студент может посещать множество курсов, и один курс может быть посещен множеством студентов.</td>\n</tr>\n<tr>\n<td>3. Пользователи и Группы</td>\n<td>Пользователь</td>\n<td>Группа</td>\n<td>Один пользователь может быть участником множества групп. Аналогично, одна группа может включать в себя множество пользователей.</td>\n</tr>\n</tbody>\n</table>\n<p>Рассмотрим более подробно связь между книгами и тегами в контексте веб-приложения, использующего Django ORM. Допустим, книги могут быть отмечены тегами для лучшей организации и поиска. В этом случае, одна книга может быть отмечена множеством тегов (например, \"Новинка\", \"Рекомендуемое\", \"Популярное\"), и один тег может быть связан с множеством книг.</p>\n<p><svg role=\"graphics-document document\" viewBox=\"-17.11956024169922 0 368.7235107421875 276\" style=\"max-width:100%\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"graph-div\" height=\"100%\"><style>@import url(\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\");'</style><style>#graph-div {\n  font-family: \"trebuchet ms\",verdana,arial,sans-serif;\n  font-size: 16px;\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n#graph-div svg {\n  font-family: \"trebuchet ms\",verdana,arial,sans-serif;\n  font-size: 16px;\n}\n\n\n\n\n\n\n\n#graph-div .relationshipLabelBox {\n  background-color: hsl(80, 100%, 96.2745098039%);\n}\n\n\n\n\n\n#graph-div .entityTitleText {\n  font-size: 18px;\n}\n\n\n\n\n\n</style><g></g><defs><marker orient=\"auto\" id=\"MD_PARENT_START\"><path d=\"M 18,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" id=\"MD_PARENT_END\"><path d=\"M 18,7 L9,13 L1,7 L9,1 Z\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ONLY_ONE_START\"><path d=\"M9,0 L9,18 M15,0 L15,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ONLY_ONE_END\"><path d=\"M3,0 L3,18 M9,0 L9,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ZERO_OR_ONE_START\"><circle r=\"6\" cy=\"9\" cx=\"21\" fill=\"white\" stroke=\"gray\"></circle><path d=\"M9,0 L9,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ZERO_OR_ONE_END\"><circle r=\"6\" cy=\"9\" cx=\"9\" fill=\"white\" stroke=\"gray\"></circle><path d=\"M21,0 L21,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ONE_OR_MORE_START\"><path d=\"M0,18 Q 18,0 36,18 Q 18,36 0,18 M42,9 L42,27\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ONE_OR_MORE_END\"><path d=\"M3,9 L3,27 M9,18 Q27,0 45,18 Q27,36 9,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ZERO_OR_MORE_START\"><circle r=\"6\" cy=\"18\" cx=\"48\" fill=\"white\" stroke=\"gray\"></circle><path d=\"M0,18 Q18,0 36,18 Q18,36 0,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><defs><marker orient=\"auto\" id=\"ZERO_OR_MORE_END\"><circle r=\"6\" cy=\"18\" cx=\"9\" fill=\"white\" stroke=\"gray\"></circle><path d=\"M21,18 Q39,0 57,18 Q39,36 21,18\" fill=\"none\" stroke=\"gray\"></path></marker></defs><path marker-start=\"url(#ONLY_ONE_START)\" marker-end=\"url(#ZERO_OR_MORE_END)\" d=\"M70,66L70,74.333C70,82.667,70,99.333,78.772,116C87.544,132.667,105.088,149.333,113.86,157.667L122.632,166\" class=\"er relationshipLine\"></path><path marker-start=\"url(#ONLY_ONE_START)\" marker-end=\"url(#ZERO_OR_MORE_END)\" d=\"M270,66L270,74.333C270,82.667,270,99.333,261.228,116C252.456,132.667,234.912,149.333,226.14,157.667L217.368,166\" class=\"er relationshipLine\"></path><g transform=\"translate(20,20 )\" id=\"entity-Book-38ec81cf-f0e5-5afc-a4a3-fa6f3d3204f1\"><rect height=\"46\" width=\"100\" y=\"0\" x=\"0\" class=\"er entityBox\"></rect><text style=\"font-size:12px\" transform=\"translate(50,12)\" y=\"0\" x=\"0\" id=\"text-entity-Book-38ec81cf-f0e5-5afc-a4a3-fa6f3d3204f1\" class=\"er entityLabel\">Book</text><rect height=\"22\" width=\"53.0859375\" y=\"24\" x=\"0\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(5,35)\" y=\"0\" x=\"0\" id=\"text-entity-Book-38ec81cf-f0e5-5afc-a4a3-fa6f3d3204f1-attr-1-type\" class=\"er entityLabel\">string</text><rect height=\"22\" width=\"46.9140625\" y=\"24\" x=\"53.0859375\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(58.0859375,35)\" y=\"0\" x=\"0\" id=\"text-entity-Book-38ec81cf-f0e5-5afc-a4a3-fa6f3d3204f1-attr-1-name\" class=\"er entityLabel\">title</text></g><g transform=\"translate(120,166 )\" id=\"entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07\"><rect height=\"90\" width=\"100\" y=\"0\" x=\"0\" class=\"er entityBox\"></rect><text style=\"font-size:12px\" transform=\"translate(50,12)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07\" class=\"er entityLabel\">Book_tags</text><rect height=\"22\" width=\"25.927083333333332\" y=\"24\" x=\"0\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(5,35)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-1-type\" class=\"er entityLabel\">int</text><rect height=\"22\" width=\"49.114583333333336\" y=\"24\" x=\"25.927083333333332\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(30.927083333333332,35)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-1-name\" class=\"er entityLabel\">id</text><rect height=\"22\" width=\"24.958333333333332\" y=\"24\" x=\"75.04166666666667\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(80.04166666666667,35)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-1-key\" class=\"er entityLabel\">PK</text><rect height=\"22\" width=\"25.927083333333332\" y=\"46\" x=\"0\" class=\"er attributeBoxEven\"></rect><text style=\"font-size:10.2px\" transform=\"translate(5,57)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-2-type\" class=\"er entityLabel\">int</text><rect height=\"22\" width=\"49.114583333333336\" y=\"46\" x=\"25.927083333333332\" class=\"er attributeBoxEven\"></rect><text style=\"font-size:10.2px\" transform=\"translate(30.927083333333332,57)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-2-name\" class=\"er entityLabel\">book_id</text><rect height=\"22\" width=\"24.958333333333332\" y=\"46\" x=\"75.04166666666667\" class=\"er attributeBoxEven\"></rect><text style=\"font-size:10.2px\" transform=\"translate(80.04166666666667,57)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-2-key\" class=\"er entityLabel\">FK</text><rect height=\"22\" width=\"25.927083333333332\" y=\"68\" x=\"0\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(5,79)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-3-type\" class=\"er entityLabel\">int</text><rect height=\"22\" width=\"49.114583333333336\" y=\"68\" x=\"25.927083333333332\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(30.927083333333332,79)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-3-name\" class=\"er entityLabel\">tag_id</text><rect height=\"22\" width=\"24.958333333333332\" y=\"68\" x=\"75.04166666666667\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(80.04166666666667,79)\" y=\"0\" x=\"0\" id=\"text-entity-Booktags-bba2bc08-cba6-55c0-a7df-3b96b218cf07-attr-3-key\" class=\"er entityLabel\">FK</text></g><g transform=\"translate(220,20 )\" id=\"entity-Tag-79f01a75-328e-5fee-acfd-3ecc1e7e19fa\"><rect height=\"46\" width=\"100\" y=\"0\" x=\"0\" class=\"er entityBox\"></rect><text style=\"font-size:12px\" transform=\"translate(50,12)\" y=\"0\" x=\"0\" id=\"text-entity-Tag-79f01a75-328e-5fee-acfd-3ecc1e7e19fa\" class=\"er entityLabel\">Tag</text><rect height=\"22\" width=\"50.38671875\" y=\"24\" x=\"0\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(5,35)\" y=\"0\" x=\"0\" id=\"text-entity-Tag-79f01a75-328e-5fee-acfd-3ecc1e7e19fa-attr-1-type\" class=\"er entityLabel\">string</text><rect height=\"22\" width=\"49.61328125\" y=\"24\" x=\"50.38671875\" class=\"er attributeBoxOdd\"></rect><text style=\"font-size:10.2px\" transform=\"translate(55.38671875,35)\" y=\"0\" x=\"0\" id=\"text-entity-Tag-79f01a75-328e-5fee-acfd-3ecc1e7e19fa-attr-1-name\" class=\"er entityLabel\">name</text></g><rect height=\"14\" width=\"159.640625\" y=\"115.63728332519531\" x=\"2.8804397583007812\" class=\"er relationshipLabelBox\"></rect><text style=\"font-size:12px\" y=\"122.63728332519531\" x=\"82.70075225830078\" id=\"rel156\" class=\"er relationshipLabel\">Связана с множеством тегов</text><rect height=\"14\" width=\"148.609375\" y=\"115.63726806640625\" x=\"182.99456787109375\" class=\"er relationshipLabelBox\"></rect><text style=\"font-size:12px\" y=\"122.63726806640625\" x=\"257.29925537109375\" id=\"rel157\" class=\"er relationshipLabel\">Связан с множеством книг</text></svg></p>\n<p>В базе данных отношение \"многие ко многим\" (many-to-many) не может быть прямо представлено, и поэтому оно организуется через создание промежуточной таблицы, которая обычно называется таблицей связей или промежуточной таблицей. В этой таблице хранятся связи между объектами из двух других таблиц.</p>\n<p>Каждая строка в этой таблице представляет собой пару значений, связывающих записи из двух таблиц. Этот подход позволяет моделировать сложные отношения между данными, такие как связи многие ко многим, без необходимости повторного использования данных или нарушения нормализации базы данных.</p>\n<h2 id=\"rabota-s-tablicej-svyazyu\"><a href=\"#rabota-s-tablicej-svyazyu\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Работа с таблицей-связью</span></a>Работа с таблицей-связью</h2>\n<p>При работе с Django создание промежуточной таблицы для связей многие ко многим осуществляется автоматически через использование поля <code>ManyToManyField</code> в определении модели. Для его использования достаточно указать только модель, с которой нужно установить связь.</p>\n<p>Модели в Django могут выглядеть следующим образом:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># books/models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Tag</span>(models.Model):\n    name = models.CharField(max_length=<span class=\"hljs-number\">30</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span>(models.Model):\n    title = models.CharField(max_length=<span class=\"hljs-number\">100</span>)\n    tags = models.ManyToManyField(Tag, related_name=<span class=\"hljs-string\">'books'</span>)  <span class=\"hljs-comment\"># Связь многие ко многим</span>\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"101\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-101\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-101\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-101.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Здесь <code>ManyToManyField</code> используется для создания двусторонней связи между <code>Book</code> и <code>Tag</code>. Благодаря параметру <code>related_name='books'</code>, можно получить доступ ко всем книгам, связанным с конкретным тегом, что делает модель данных гибкой и мощной для реализации сложных взаимодействий между объектами.</p>\n<aside>\nℹ️ Расположение `ManyToManyField` в определении модели не зависит от конкретной модели, и оно может быть размещено в любой модели, между которыми требуется установить данную связь.\n</aside>\n<h3 id=\"avtomaticheski-sozdavaemye-tablicy-svyazi\"><a href=\"#avtomaticheski-sozdavaemye-tablicy-svyazi\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Автоматически создаваемые таблицы-связи</span></a>Автоматически создаваемые таблицы-связи</h3>\n<p>При определении отношения многие ко многим с помощью <code>ManyToManyField</code>, Django автоматически создает таблицу-связку для хранения информации о связях между объектами двух моделей.</p>\n<p>Атрибут <code>through</code> в поле <code>ManyToManyField</code> в Django ORM указывает на модель, которая используется в качестве промежуточной таблицы связи между двумя другими моделями.</p>\n<p>Давайте рассмотрим, как можно получить доступ к автоматически сгенерированной модели связи и её название таблицы в базе данных:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-built_in\">print</span>(Book.tags.through)  <span class=\"hljs-comment\"># &lt;class 'books.models.Book_tags'&gt;</span>\n<span class=\"hljs-built_in\">print</span>(Book.tags.through._meta.db_table)  <span class=\"hljs-comment\"># books_book_tags</span>\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"119\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-119\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-119\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-119.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<ul>\n<li><code>Book.tags.through</code>: Этот атрибут возвращает класс промежуточной модели, используемой для связи многие ко многим между моделями <code>Book</code> и <code>Tag</code>.</li>\n<li><code>Book.tags.through._meta.db_table</code>: Используя атрибут <code>_meta.db_table</code>, можно получить имя таблицы в базе данных, ассоциированной с промежуточной моделью.</li>\n</ul>\n<aside>\nℹ️ В данном случае, Django автоматически создает промежуточную модель с именем `Book_tags`. Название модели формируется из имени модели, определяющей связь, и названия поля связи, следуя шаблону `&lt;имя_модели_определяющей_связь&gt;_&lt;название_поля_связи&gt;`. \nА имя таблицы будет `books_book_tags`. Название этой таблицы формируется из имени модели, определяющей связь, и названия поля связи, следуя шаблону `&lt;имя_приложения&gt;_&lt;имя_модели_определяющей_связь&gt;_&lt;название_поля_связи&gt;`.\n</aside>\n<p>В SQL таблице, соответствующей модели <code>Book_tags</code>, будут следующие поля:</p>\n<ul>\n<li><code>id</code> - автоматически сгенерированный первичный ключ.</li>\n<li><code>book_id</code> - внешний ключ, указывающий на конкретную книгу в таблице <code>Book</code>.</li>\n<li><code>tag_id</code> - внешний ключ, указывающий на конкретный тег в таблице <code>Tag</code>.</li>\n</ul>\n<h3 id=\"sobstvennaya-model-svyaz\"><a href=\"#sobstvennaya-model-svyaz\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Собственная модель связь</span></a>Собственная модель связь</h3>\n<p>Атрибут <code>through</code> используется для указания собственной модели, когда необходимо хранить дополнительную информацию о связи между моделями, которую невозможно представить, используя только стандартное поведение <code>ManyToManyField</code>.</p>\n<p>Использование собственной промежуточной модели особенно полезно в следующих случаях:</p>\n<ul>\n<li><strong>Хранение дополнительных данных о связи:</strong> Когда нужно сохранить дополнительную информацию о каждой уникальной связи между объектами.</li>\n<li><strong>Контроль над связующей таблицей:</strong> Когда разработчику необходим полный контроль над операциями создания, обновления и удаления связей.</li>\n<li><strong>Реализация сложной бизнес-логики:</strong> Когда связи многие ко многим участвуют в сложной бизнес-логике, требующей дополнительных проверок или действий при работе с данными связи.</li>\n</ul>\n<p>Допустим, есть модели <code>Book</code> и <code>Tag</code>, а также необходимо сохранить информацию о дате, когда тег был присвоен книге. В таком случае стандартной промежуточной модели не хватает и следует опередить собственную промежуточную модель <code>BookTag</code> и указать её в атрибуте <code>through</code> поля <code>ManyToManyField</code></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># books/models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Tag</span>(models.Model):\n    name = models.CharField(max_length=<span class=\"hljs-number\">30</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span>(models.Model):\n    title = models.CharField(max_length=<span class=\"hljs-number\">100</span>)\n    tags = models.ManyToManyField(\n        Tag,\n        related_name=<span class=\"hljs-string\">'books'</span>,\n        through=<span class=\"hljs-string\">'books.BookTag'</span>,  <span class=\"hljs-comment\"># Указание собственной промежуточная модель</span>\n    )\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BookTag</span>(models.Model):  <span class=\"hljs-comment\"># Объявление собственной промежуточной модели</span>\n    book = models.ForeignKey(Book, on_delete=models.CASCADE)\n    tag = models.ForeignKey(Tag, on_delete=models.CASCADE)\n    created_at = models.DateTimeField(auto_now_add=<span class=\"hljs-literal\">True</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"183\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-183\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-183\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-183.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Здесь модель <code>BookTag</code> выступает в качестве промежуточной модели для связи многие ко многим между <code>Book</code> и <code>Tag</code>, позволяя сохранить дополнительное поле <code>created_at</code>, указывающее на временную метку присвоения тега книге.</p>\n<p>В большинстве случаев достаточно стандартной модели и её полей.</p>\n<h2 id=\"rabota-so-svyazyami\"><a href=\"#rabota-so-svyazyami\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Работа со связями</span></a>Работа со связями</h2>\n<p>Чтобы создать новую связь между объектами, можно воспользоваться методами <code>add</code> или <code>create</code> объекта, определенного через <code>ManyToManyField</code>. А метод <code>remove</code> удаляет связь между объектами.</p>\n<p>Метод <code>set</code> позволяет полностью обновить набор связей между объектам. Это означает, что если у вас есть модель, связанная с другой моделью через <code>ManyToManyField</code>, вы можете использовать метод <code>set</code> для определения нового набора связанных объектов в одной операции, автоматически удаляя все предыдущие связи и устанавливая новые.</p>\n<h3 id=\"dobavlenie-uzhe-sushestvuyushego-obuekta\"><a href=\"#dobavlenie-uzhe-sushestvuyushego-obuekta\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Добавление уже существующего объекта</span></a>Добавление уже существующего объекта</h3>\n<p>Метод <code>add</code> может принимать один объект или несколько объектов, которые должны быть добавлены к текущему набору связанных объектов. Django автоматически обрабатывает добавление, обеспечивая создание новых связей в соответствующей таблице связи <code>ManyToManyField</code>, не затрагивая уже существующие связи.</p>\n<p>Если объект уже существует и вы хотите добавить его к другому объекту, используйте метод <code>add</code>, передавая в него существующий объект.</p>\n<p><strong>Пример добавления существующего тега к книге:</strong></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">book = Book.objects.get(<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span>)\nexisting_tag = Tag.objects.get(name=<span class=\"hljs-string\">\"Бестселлер\"</span>)\n\nbook.tags.add(existing_tag)  <span class=\"hljs-comment\"># Добавление существующего тега к книге</span>\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"211\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-211\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-211\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-211.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом примере, после выполнения кода, к объекту <code>book</code> будет добавлена связь с объектом <code>existing_tag</code>. Если эта связь уже существовала, Django просто проигнорирует действие, не вызывая ошибок или дублирования. Метод <code>add</code> удобно использовать, когда нужно расширить список связанных объектов без риска потери или изменения существующих связей.</p>\n<h3 id=\"sozdanie-novogo-obuekta-i-ego-dobavlenie\"><a href=\"#sozdanie-novogo-obuekta-i-ego-dobavlenie\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Создание нового объекта и его добавление</span></a>Создание нового объекта и его добавление</h3>\n<p>В Django ORM, метод <code>create</code> в контексте отношений <code>ManyToManyField</code> позволяет не только создать новый связанный объект, но и автоматически добавить его к текущей коллекции связанных объектов. Этот метод объединяет в себе создание нового объекта и его немедленное добавление к связанному набору, что упрощает работу с моделями, имеющими отношения многие ко многим.</p>\n<p>Метод <code>create</code> принимает аргументы, которые соответствуют полям создаваемого объекта, и возвращает новый экземпляр этого объекта, автоматически добавляя его к связанному набору в контексте текущего объекта. Это значит, что для установления связи не требуется дополнительных вызовов метода <code>add</code> — создание и добавление происходит одновременно.</p>\n<p><strong>Пример создания нового тега и его добавления к книге:</strong></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">book = Book.objects.get(<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span>)\n<span class=\"hljs-comment\"># Создание нового тега и его автоматическое добавление к текущей книге</span>\nnew_tag = book.tags.create(name=<span class=\"hljs-string\">\"Бестселлер\"</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"227\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-227\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-227\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-227.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом примере для книги с <code>id=1</code> создается новый тег \"Бестселлер\" и автоматически добавляется к списку тегов этой книги. В отличие от метода <code>add</code>, который требует передачи уже существующего объекта, метод <code>create</code> создает новый объект в связанной модели и сразу же устанавливает между ними связь.</p>\n<h3 id=\"udalenie-svyazej\"><a href=\"#udalenie-svyazej\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Удаление связей</span></a>Удаление связей</h3>\n<p>В Django ORM, метод <code>remove</code> используется в контексте отношений <code>ManyToManyField</code> для удаления одного или нескольких объектов из связанной коллекции. Этот метод позволяет удалять существующие связи между объектами без удаления самих объектов из базы данных.</p>\n<p>Чтобы удалить существующую связь между объектами, используйте метод <code>remove()</code>.</p>\n<p><strong>Пример удаления тега из книги:</strong></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">book = Book.objects.get(<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span>)\ntag_to_remove = Tag.objects.get(name=<span class=\"hljs-string\">\"Новинка\"</span>)\n\nbook.tags.remove(tag_to_remove)  <span class=\"hljs-comment\"># Удаление тега у книги</span>\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"243\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-243\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-243\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-243.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Следует отметить, что сами объекты <code>book</code> и <code>tag_to_remove</code> останутся в базе данных; удалится только связь из промежуточной таблицы.</p>\n<h3 id=\"obnovlenie-svyazej\"><a href=\"#obnovlenie-svyazej\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">**Обновление связей**</span></a><strong>Обновление связей</strong></h3>\n<p>Метод <code>set</code> принимает итерируемый объект, содержащий набор объектов, которые должны быть связаны с текущим объектом. Все предыдущие связи удаляются, и устанавливаются только те связи, которые указаны в переданном итерируемом объекте. Это позволяет легко обновлять связанные данные без необходимости индивидуального добавления или удаления каждой связи.</p>\n<p>Допустим, необходимо обновить набор тегов для конкретной книги. Сначала необходимо получить или создать экземпляры <code>Tag</code>, которые будут ассоциироваться с книгой:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> myapp.models <span class=\"hljs-keyword\">import</span> Book, Tag\n\n<span class=\"hljs-comment\"># Получаем книгу, для которой нужно обновить теги</span>\nbook = Book.objects.get(<span class=\"hljs-built_in\">id</span>=<span class=\"hljs-number\">1</span>)\n\n<span class=\"hljs-comment\"># Получаем теги, которые будут связаны с книгой</span>\ntag1 = Tag.objects.get(name=<span class=\"hljs-string\">\"Новинка\"</span>)\ntag2 = Tag.objects.get(name=<span class=\"hljs-string\">\"Популярное\"</span>)\n\n<span class=\"hljs-comment\"># Используем метод set() для установки нового набора тегов для книги</span>\nbook.tags.<span class=\"hljs-built_in\">set</span>([tag1, tag2])\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"256\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-256\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-256\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-256.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом примере, после выполнения кода, книга будет связана только с тегами \"Новинка\" и \"Популярное\". Все предыдущие связи между этой книгой и другими тегами будут удалены.</p>\n"},"router":{"pathname":"../../../Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие ко многим/task.html"},"lang":"ru"};
                </script>
                <script type="application/javascript" src="../../../_bundle/react.js"></script>
<script type="application/javascript" src="../../../_bundle/app.js"></script>
<script type="application/javascript" src="../../../_bundle/vendor.js"></script>
            </body>
        </html>
    