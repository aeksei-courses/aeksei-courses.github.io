
        <!DOCTYPE html>
        <html lang="ru" dir="ltr">
            <head>
                <meta charset="utf-8">
                <base href="../../../" />
                
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Работа с миграциями данных в Django | django-web-api</title>
                <style type="text/css">
                    body {
                        height: 100vh;
                    }
                </style>
                <link type="text/css" rel="stylesheet" href="_bundle/vendor.css" />
<link type="text/css" rel="stylesheet" href="_bundle/app.css" />
                
                
            </head>
            <body class="g-root g-root_theme_light">
                <div id="root"></div>
                <script type="application/javascript">
                   window.STATIC_CONTENT = false
                   window.__DATA__ = {"data":{"leading":false,"toc":{"title":"django-web-api","href":"index.html","items":[{"name":"Введение в курс","href":"course.html","id":"Введение в курс-0-0.0014387238918487366"},{"name":"Основы ORM в Django","items":[{"name":"Введение в курс","href":"Основы ORM в Django/section.html","id":"Введение в курс-0-0.7666589548426594"},{"name":"ORM модели","items":[{"name":"Введение в модели Django","href":"Основы ORM в Django/ORM модели/Введение в модели Django/task.html","id":"Введение в модели Django-0-0.14743452080312935"},{"name":"Работа с миграциями данных","href":"Основы ORM в Django/ORM модели/Работа с миграциями данных/task.html","id":"Работа с миграциями данных-1-0.9519379486277901"},{"name":"Хорошие практики по работе с миграциями","href":"Основы ORM в Django/ORM модели/Хорошие практики по работе с миграциями/task.html","id":"Хорошие практики по работе с миграциями-2-0.6846268741932104"},{"name":"Основные типы полей и их особенности","href":"Основы ORM в Django/ORM модели/Основные типы полей и их особенности/task.html","id":"Основные типы полей и их особенности-3-0.4283831349369671"},{"name":"Добавление данных через фикстуры","href":"Основы ORM в Django/ORM модели/Добавление данных через фикстуры/task.html","id":"Добавление данных через фикстуры-4-0.3960911815800805"}],"id":"ORM модели-1-0.09407856543345372"},{"name":"CRUD операции","items":[{"name":"Чтение данных","href":"Основы ORM в Django/CRUD операции/Чтение данных/task.html","id":"Чтение данных-0-0.20124676603941172"},{"name":"Создание и обновление объектов","href":"Основы ORM в Django/CRUD операции/Создание и обновление объектов/task.html","id":"Создание и обновление объектов-1-0.7326019915803215"},{"name":"Удаление объектов","href":"Основы ORM в Django/CRUD операции/Удаление объектов/task.html","id":"Удаление объектов-2-0.40739630175174746"}],"id":"CRUD операции-2-0.8738970774604455"},{"name":"Работа с админкой","items":[{"name":"Основы работы с админкой","href":"Основы ORM в Django/Работа с админкой/Основы работы с админкой/task.html","id":"Основы работы с админкой-0-0.19083283986185595"},{"name":"Настройка отображения экземпляров моделей в админ панели","href":"Основы ORM в Django/Работа с админкой/Настройка отображения экземпляров моделей в админ панели/task.html","id":"Настройка отображения экземпляров моделей в админ панели-1-0.690447557863902"},{"name":"Основы работы с админкой","href":"Основы ORM в Django/Работа с админкой/Дополнительные настройки админки/task.html","id":"Основы работы с админкой-2-0.09550161306432159"}],"id":"Работа с админкой-3-0.6117335982721757"}],"id":"Основы ORM в Django-1-0.5622752869816867"},{"name":"Расширенные возможности ORM в Django","items":[{"name":"Введение в модуль","href":"Расширенные возможности ORM в Django/section.html","id":"Введение в модуль-0-0.9704472203094248"},{"name":"Отладка запросов","items":[{"name":"Установка и настройка Debug Toolbar","href":"Расширенные возможности ORM в Django/Отладка запросов/Установка и настройка Debug Toolbar/task.html","id":"Установка и настройка Debug Toolbar-0-0.7020417840347131"},{"name":"Практические примеры использования debugsqlshell","href":"Расширенные возможности ORM в Django/Отладка запросов/Практические примеры использования debugsqlshell/task.html","id":"Практические примеры использования debugsqlshell-1-0.570026269756857"}],"id":"Отладка запросов-1-0.1252638995880071"},{"name":"Отношения между моделями","items":[{"name":"Отношение многие к одному","href":"Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие к одному/task.html","id":"Отношение многие к одному-0-0.3229340841060133"},{"name":"Отношение один ко многим","href":"Расширенные возможности ORM в Django/Отношения между моделями/Отношение один ко многим/task.html","id":"Отношение один ко многим-1-0.9510050044400693"},{"name":"Отношение многие ко многим","href":"Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие ко многим/task.html","id":"Отношение многие ко многим-2-0.9417359013079145"}],"id":"Отношения между моделями-2-0.13163697430883925"},{"name":"Фильтрация и запросы с помощью Q-объектов","items":[{"name":"Фильтрация по полям модели и связанным моделям","href":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Фильтрация по полям модели и связанным моделям/task.html","id":"Фильтрация по полям модели и связанным моделям-0-0.9979380355659244"},{"name":"Использование Q-объектов для сложных запросов","href":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Использование Q-объектов для сложных запросов/task.html","id":"Использование Q-объектов для сложных запросов-1-0.7562798037957761"},{"name":"Группировка данных и агрегация","href":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Группировка данных и агрегация/task.html","id":"Группировка данных и агрегация-2-0.04640843952463514"}],"id":"Фильтрация и запросы с помощью Q-объектов-3-0.1864571785992477"},{"name":"Оптимизация запросов","items":[{"name":"Подводные камни при работе с ORM запросами","href":"Расширенные возможности ORM в Django/Оптимизация запросов/Подводные камни при работе с ORM запросами/task.html","id":"Подводные камни при работе с ORM запросами-0-0.38320859167187105"},{"name":"Выбор полей запроса","href":"Расширенные возможности ORM в Django/Оптимизация запросов/Выбор полей запроса/task.html","id":"Выбор полей запроса-1-0.48434008006935847"},{"name":"Массовое создание и обновление","href":"Расширенные возможности ORM в Django/Оптимизация запросов/Массовое создание и обновление/task.html","id":"Массовое создание и обновление-2-0.5211022628986557"}],"id":"Оптимизация запросов-4-0.8102985329003554"}],"id":"Расширенные возможности ORM в Django-2-0.5082696740041528"},{"name":"Основы разработки REST API","items":[{"name":"Введение в модуль","href":"Основы разработки REST API/section.html","id":"Введение в модуль-0-0.005666732745137404"},{"name":"Введение в REST API","items":[{"name":"Введение в RESTful API","href":"Основы разработки REST API/Введение в REST API/Введение в RESTful API/task.html","id":"Введение в RESTful API-0-0.9868528167330852"},{"name":"Endpoint и CRUD операции в REST API","href":"Основы разработки REST API/Введение в REST API/Endpoint и CRUD операции в REST API/task.html","id":"Endpoint и CRUD операции в REST API-1-0.971449843039184"},{"name":"Введение в Django REST Framework","href":"Основы разработки REST API/Введение в REST API/Введение в Django REST Framework/task.html","id":"Введение в Django REST Framework-2-0.6635893201208944"}],"id":"Введение в REST API-1-0.023233951024407284"},{"name":"Сериализаторы в Django REST Framework","items":[{"name":"Сериализаторы в DRF","href":"Основы разработки REST API/Сериализаторы в Django REST Framework/Сериализаторы в DRF/task.html","id":"Сериализаторы в DRF-0-0.5044550674279948"},{"name":"Модельные и вложенные сериализаторы","href":"Основы разработки REST API/Сериализаторы в Django REST Framework/Модельные и вложенные сериализаторы/task.html","id":"Модельные и вложенные сериализаторы-1-0.6998701821606768"}],"id":"Сериализаторы в Django REST Framework-2-0.3503826098519198"},{"name":"APIView в Django REST Framework","items":[{"name":"Применение статусных кодов в REST API","href":"Основы разработки REST API/APIView в Django REST Framework/Применение статусных кодов в REST API/task.html","id":"Применение статусных кодов в REST API-0-0.008144639484469307"},{"name":"Список объектов и добавление новых объектов","href":"Основы разработки REST API/APIView в Django REST Framework/Список объектов и добавление новых объектов/task.html","id":"Список объектов и добавление новых объектов-1-0.14551276923065526"},{"name":"Детальная работа с объектом","href":"Основы разработки REST API/APIView в Django REST Framework/Детальная работа с объектом/task.html","id":"Детальная работа с объектом-2-0.5837717885871536"}],"id":"APIView в Django REST Framework-3-0.3047449673830418"}],"id":"Основы разработки REST API-3-0.366920508448328"},{"name":"Типовые API","items":[{"name":"Введение в модуль","href":"Типовые API/section.html","id":"Введение в модуль-0-0.20906728772289873"},{"name":"Введение в тестирование","items":[{"name":"Test-Driven Development (TDD)","href":"Типовые API/Введение в тестирование/Test-Driven Development (TDD)/task.html","id":"Test-Driven Development (TDD)-0-0.4976267852417122"},{"name":"Написание, выполнение и завершение тестов","href":"Типовые API/Введение в тестирование/Написание, выполнение и завершение тестов/task.html","id":"Написание, выполнение и завершение тестов-1-0.953851474952035"}],"id":"Введение в тестирование-1-0.10966333602444944"},{"name":"Тестирование в Django","items":[{"name":"Тестирование в Django","href":"Типовые API/Тестирование в Django/Тестирование в Django/task.html","id":"Тестирование в Django-0-0.5647276769639085"}],"id":"Тестирование в Django-2-0.8794910650209229"},{"name":"Типовые (generic) API","items":[{"name":"GenericAPIView","href":"Типовые API/Типовые (generic) API/GenericAPIView/task.html","id":"GenericAPIView-0-0.5752742253161756"},{"name":"OpenAPI документация","href":"Типовые API/Типовые (generic) API/OpenAPI документация/task.html","id":"OpenAPI документация-1-0.4042330257052871"},{"name":"Фильтрация, поиск и пагинация","href":"Типовые API/Типовые (generic) API/Фильтрация, поиск и пагинация/task.html","id":"Фильтрация, поиск и пагинация-2-0.800831582975301"}],"id":"Типовые (generic) API-3-0.5873884462850938"}],"id":"Типовые API-4-0.9089825410629631"}],"base":"."},"meta":{"metadata":[],"style":[],"script":[]},"assets":[],"headings":[{"title":"Цель урока","href":"#cel-uroka","level":2},{"title":"Миграции","href":"#migracii","level":2,"items":[{"title":"Что такое миграции и зачем они нужны","href":"#chto-takoe-migracii-i-zachem-oni-nuzhny","level":3}]},{"title":"Работа с миграциями","href":"#rabota-s-migraciyami","level":2,"items":[{"title":"Применение миграций","href":"#primenenie-migracij","level":3},{"title":"Как Django отслеживает изменения в моделях","href":"#kak-django-otslezhivaet-izmeneniya-v-modelyah","level":3},{"title":"Обновление моделей","href":"#obnovlenie-modelej","level":3},{"title":"Отмена миграций","href":"#otmena-migracij","level":3}]}],"title":"Работа с миграциями данных в Django","includes":[],"html":"<h2 id=\"cel-uroka\"><a href=\"#cel-uroka\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Цель урока</span></a>Цель урока</h2>\n<p>К концу этого урока вы будете знать, как управлять миграциями в Django для эффективной работы с базой данных. Миграции позволяют отслеживать и применять изменения в моделях, обеспечивая актуальность структуры вашей базы данных. Вы научитесь создавать, применять и откатывать миграции, понимая, как Django преобразует изменения моделей в SQL-команды для обновления схемы базы данных.</p>\n<h2 id=\"migracii\"><a href=\"#migracii\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Миграции</span></a>Миграции</h2>\n<p>Миграции в Django - это механизм для применения и отката изменений в структуре базы данных. Это позволяет разработчикам изменять структуру данных без прямого взаимодействия с SQL, автоматизируя большую часть процесса управления схемой базы данных.</p>\n<h3 id=\"chto-takoe-migracii-i-zachem-oni-nuzhny\"><a href=\"#chto-takoe-migracii-i-zachem-oni-nuzhny\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Что такое миграции и зачем они нужны</span></a>Что такое миграции и зачем они нужны</h3>\n<p>Миграции необходимы для контролируемого изменения схемы базы данных в процессе разработки. Без миграций любое изменение в моделях требовало бы ручного обновления схемы базы данных, что увеличивает риск ошибок и усложняет совместную работу над проектом.</p>\n<p>Миграции – это система контроля версий для вашей базы данных. Они нужны для:</p>\n<ul>\n<li>Обновления схемы базы данных.</li>\n<li>Воспроизводимости и отката изменений структуры данных.</li>\n<li>Синхронизации изменений структуры данных между разработчиками.</li>\n</ul>\n<h2 id=\"rabota-s-migraciyami\"><a href=\"#rabota-s-migraciyami\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Работа с миграциями</span></a>Работа с миграциями</h2>\n<p>Применение миграций в Django позволяет обновить схему базы данных до последней версии, соответствующей вашим моделям.</p>\n<p>Если запустить новое приложение командой <code>python manage.py runserver</code>, то можно увидеть следующее предупреждение:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs\">...\nYou have 19 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, book_app, contenttypes, sessions.\nRun 'python manage.py migrate' to apply them.\n...\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"47\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-47\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-47\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-47.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Это сообщение означает, что в вашем проекте есть 19 непримененных миграций базы данных.</p>\n<p>Непримененные миграции могут привести к неправильной работе вашего проекта, так как они содержат изменения, которые еще не были применены к базе данных.</p>\n<h3 id=\"primenenie-migracij\"><a href=\"#primenenie-migracij\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Применение миграций</span></a>Применение миграций</h3>\n<p>Для применения миграций используйте команду:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs bash\">python manage.py migrate\n\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"60\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-60\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-60\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-60.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>После чего вы увидите следующие сообщения</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs\">Operations to perform:\n  Apply all migrations: admin, auth, contenttypes, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying auth.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying admin.0002_logentry_remove_auto_add... OK\n  Applying admin.0003_logentry_add_action_flag_choices... OK\n  Applying contenttypes.0002_remove_content_type_name... OK\n  Applying auth.0002_alter_permission_name_max_length... OK\n  Applying auth.0003_alter_user_email_max_length... OK\n  Applying auth.0004_alter_user_username_opts... OK\n  Applying auth.0005_alter_user_last_login_null... OK\n  Applying auth.0006_require_contenttypes_0002... OK\n  Applying auth.0007_alter_validators_add_error_messages... OK\n  Applying auth.0008_alter_user_username_max_length... OK\n  Applying auth.0009_alter_user_last_name_max_length... OK\n  Applying auth.0010_alter_group_name_max_length... OK\n  Applying auth.0011_update_proxy_permissions... OK\n  Applying auth.0012_alter_user_first_name_max_length... OK\n  Applying sessions.0001_initial... OK\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"64\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-64\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-64\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-64.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Django «из коробки» уже содержит некоторый набор миграций. Но если обратить внимание, то миграции приложения <code>books</code> не были применены, хотя модель там есть. Одна из причин в том, что Django не отслеживает изменения в моделях приложений, которые не были подключены в <code>INSTALLED_APPS</code>.</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># books_library/settings.py</span>\nINSTALLED_APPS = [\n    ...,\n    <span class=\"hljs-string\">\"books\"</span>,\n]\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"68\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-68\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-68\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-68.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<h3 id=\"kak-django-otslezhivaet-izmeneniya-v-modelyah\"><a href=\"#kak-django-otslezhivaet-izmeneniya-v-modelyah\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Как Django отслеживает изменения в моделях</span></a>Как Django отслеживает изменения в моделях</h3>\n<p>Django использует механизм миграций для отслеживания изменений в файлах моделей. При изменении или добавлении новой модели Django может автоматически сгенерировать файл миграции, который описывает, как эти изменения должны быть применены к базе данных.</p>\n<p>Django использует команду <code>makemigrations</code> для автоматического создания файлов миграций, которые описывают изменения в моделях. Эти файлы затем могут быть применены к базе данных для обновления её структуры.</p>\n<p>Файлы миграции располагаются внутри приложения в пакете <code>migrations</code> и представляют собой python скрипты.</p>\n<p>Для создания миграций на основе ваших изменений в моделях, используйте команду:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs bash\">python manage.py makemigrations\n\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"84\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-84\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-84\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-84.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Вот что будет выведено в результате этой команды:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs\">Migrations for 'books':\n  books/migrations/0001_initial.py\n    - Create model Book\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"88\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-88\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-88\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-88.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Эта команда создаст новые файлы миграций в папке <code>migrations</code> каждого приложения, содержащего изменения в моделях.</p>\n<p>После выполнения команды <code>python manage.py makemigrations</code> в Django ORM создается миграционный файл для модели <code>Book</code> в приложении <code>books</code>. Файл <code>books/migrations/0001_initial.py</code>, содержит инструкции о создании таблицы в базе данных для модели <code>Book</code>, включая определение ее полей и ограничений.</p>\n<p>После создания миграционного файла, он будет готов к применению к базе данных с помощью команды <code>python manage.py migrate</code>, чтобы создать или обновить таблицу в соответствии с определением модели.</p>\n<p>После создания миграций, используйте команду <code>migrate</code>, чтобы применить изменения к базе данных. В результате выполения этой команды модель <code>Book</code> будет отображена в базе данных.</p>\n<p>Вот что будет выведено в результате этой команды:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs\">Operations to perform:\n  Apply all migrations: admin, auth, books, contenttypes, sessions\nRunning migrations:\n  Applying books.0001_initial... OK\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"104\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-104\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-104\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-104.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Django отследил, что к базе данных не была применена только одна миграция из приложения <code>books</code>. Как он это понял? Применённые миграции Django хранит в БД в таблице <code>django_migrations</code>. Он сравнивает, файлы внутри <code>migrations</code> каждого зарегистрированного приложения, и применяет миграции, которые ещё не были применены.</p>\n<h3 id=\"obnovlenie-modelej\"><a href=\"#obnovlenie-modelej\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Обновление моделей</span></a>Обновление моделей</h3>\n<p>Рано или поздно настанет момент, что в модель нужно будет внести изменения. Например,  для поля <code>year</code> решено использовать тип <code>PositiveSmallIntegerField</code>.</p>\n<aside>\nℹ️ Поле типа `PositiveSmallIntegerField` в Django ORM представляет собой целочисленное поле, которое может хранить только положительные значения. Это поле хранит значения в диапазоне от 0 до 32767 включительно.\n<p>Использование <code>PositiveSmallIntegerField</code> для поля в котором хранится год издания, полезно для ограничений на диапазон допустимых значений поля, что может быть полезно для валидации данных и обеспечению их целостности. Кроме того, такое использование позволяет экономить место в базе данных, так как <code>PositiveSmallIntegerField</code> требует меньше места, чем, например, <code>IntegerField</code>.</p>\n</aside>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># books/models.py</span>\n<span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span>(models.Model):\n    title = models.CharField(max_length=<span class=\"hljs-number\">100</span>)\n    year = models.PositiveSmallIntegerField()  <span class=\"hljs-comment\"># Обновлён тип поля с IntegerField</span>\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"119\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-119\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-119\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-119.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>После изменения модели необходимо сгенерировать новый файл миграции и применить его. Командам <code>migrations</code> и <code>migrate</code> можно в явном виде указать название приложения.</p>\n<ul>\n<li><code>python manage.py makemigrations &lt;app_name&gt;</code> — Создать миграции только для приложения &lt;app_name&gt;</li>\n<li><code>python manage.py migrate &lt;app_name&gt;</code> — Применить миграции только для приложения &lt;app_name&gt;</li>\n</ul>\n<aside>\n💡 Во время разработки может быть удобно создавать и применять миграции только для определенного приложения, чтобы избежать влияния изменений в других частях проекта.\n</aside>\n<p>Сейчас изменения были внесены в приложении <code>books</code>, поэтому укажем его при работе с миграциями. Используя<code>&amp;&amp;</code> можно объединить две команды и выполнить их одновременно.</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs bash\">python [manage.py](http://manage.py/) makemigrations books &amp;&amp; python [manage.py](http://manage.py/) migrate books\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"140\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-140\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-140\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-140.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В результате выполнения команды будет выведена следующая информация</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs\">Migrations for 'books':\n  books/migrations/0002_alter_book_year.py\n    - Alter field year on book\nOperations to perform:\n  Apply all migrations: books\nRunning migrations:\n  Applying books.0002_alter_book_year... OK\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"144\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-144\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-144\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-144.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<h3 id=\"otmena-migracij\"><a href=\"#otmena-migracij\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Отмена миграций</span></a>Отмена миграций</h3>\n<p>Выполнив обновление поля <code>year</code> с типа <code>IntegerField</code> на <code>PositiveSmallIntegerField</code>, возник вопрос, а могут ли в библиотеке храниться какие-то записи, которые датированы датами до нашей эры? Ещё больше вопросов, а как это хранить. Поэтому принято решение на текущем этапе не накладывать ограничения на положительность значений для года публикации, и изменить тип на <code>SmallIntegerField</code>.</p>\n<p>Вновь изменив в модели <code>Book</code> поле <code>year</code> на тип <code>SmallIntegerField</code>, правильным решением будет создать новую миграцию и применить её. Так следует поступать в большинстве случаев.</p>\n<p>Если выполнить команду <code>python manage.py makemigrations books</code>, то будет новая миграция <code>books/migrations/0003_alter_book_year.py</code></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs\">Migrations for 'books':\n  books/migrations/0003_alter_book_year.py\n    - Alter field year on book\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"157\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-157\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-157\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-157.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>И история миграций будет следующей:</p>\n<ul>\n<li><code>0001_initial</code> — создание модели <code>Book</code></li>\n<li><code>0002_alter_book_year</code> — обновление поля <code>year</code> типа <code>IntegerField</code> на <code>PositiveSmallIntegerField</code></li>\n<li><code>0003_alter_book_year</code> — обновление поля <code>year</code> типа <code>PositiveSmallIntegerField</code> на <code>SmallIntegerField</code></li>\n</ul>\n<p>Но сейчас разработка модели велась локально, и никому кроме вас эти миграции не известны. Достаточно чтобы в истории изменений оставались только создание модели <code>Book</code> и обновление поля <code>year</code> типа <code>IntegerField</code> сразу на <code>SmallIntegerField</code>.</p>\n<p>Просто удалить файл <code>0002_alter_book_year.py</code> и сгенерировать новый файл будет не правильным, так как миграция <code>0002_alter_book_year</code> уже была зафиксирована в БД и это может привести к ошибкам. Если вы хотите отменить последнюю или несколько последних миграций, то необходимо выполнить следующую команду <code>python manage.py migrate &lt;app_name&gt; &lt;previous_migration&gt;</code>, где <code>&lt;app_name&gt;</code> название приложения, <code>&lt;previous_migration&gt;</code> номер миграции, к которой вы хотите вернуться.</p>\n<p>Тогда откатим миграции до момента когда была создана модель, после чего можно будет удалить не применённые миграции, а именно миграцию <code>0002_alter_book_year</code> и сгенерировать новую мигацию, которая будет содержать изменение поля <code>year</code> с типа <code>IntegerField</code> сразу на тип <code>SmallIntegerField</code>.</p>\n<ol>\n<li>\n<p>Указываем, что хотим откатить до момента, когда создаётся модель <code>Book</code></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs bash\">python manage.py migrate books 0001\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"192\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-192\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-192\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-192.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n</li>\n<li>\n<p>Удаляем миграцию <code>0002_alter_book_year.py</code></p>\n</li>\n<li>\n<p>Проверяем что в модели <code>Book</code> поле <code>year</code> имеет тип <code>SmallIntegerField</code>.</p>\n</li>\n<li>\n<p>Генерируем новую миграцию и применяем её.</p>\n</li>\n</ol>\n"},"router":{"pathname":"Основы ORM в Django/ORM модели/Работа с миграциями данных/task.html"},"lang":"ru","langs":["ru"]};
                </script>
                <script type="application/javascript" src="_bundle/react.js"></script>
<script type="application/javascript" src="_bundle/app.js"></script>
<script type="application/javascript" src="_bundle/vendor.js"></script>
            </body>
        </html>
    