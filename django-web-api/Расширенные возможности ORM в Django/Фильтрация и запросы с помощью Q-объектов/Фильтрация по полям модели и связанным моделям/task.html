
        <!DOCTYPE html>
        <html lang="ru" dir="ltr">
            <head>
                <meta charset="utf-8">
                <base href="../../../" />
                
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Фильтрация по полям модели и связанным моделям | Разработка REST API с помощью Django REST Framework</title>
                <style type="text/css">
                    body {
                        height: 100vh;
                    }
                </style>
                <link type="text/css" rel="stylesheet" href="../_bundle/vendor.css" />
<link type="text/css" rel="stylesheet" href="../_bundle/app.css" />
                
                
            </head>
            <body class="g-root g-root_theme_light">
                <div id="root"></div>
                <script type="application/javascript">
                   window.STATIC_CONTENT = false
                   window.__DATA__ = {"data":{"leading":false,"toc":{"title":"Разработка REST API с помощью Django REST Framework","href":"index.html","navigation":{"logo":{"url":"/","text":"IDE EDU"}},"items":[{"name":"Введение в курс","href":"course.html","id":"Введение в курс-0-0.7907739522975461"},{"name":"Основы ORM в Django","expanded":true,"items":[{"name":"Введение в модуль","href":"Основы ORM в Django/section.html","id":"Введение в модуль-0-0.9044838773454607"},{"name":"ORM модели","items":[{"name":"Введение в модели Django","href":"Основы ORM в Django/ORM модели/Введение в модели Django/task.html","id":"Введение в модели Django-0-0.29312786552951686"},{"name":"Работа с миграциями данных","href":"Основы ORM в Django/ORM модели/Работа с миграциями данных/task.html","id":"Работа с миграциями данных-1-0.9797747677984907"},{"name":"Хорошие практики по работе с миграциями","href":"Основы ORM в Django/ORM модели/Хорошие практики по работе с миграциями/task.html","id":"Хорошие практики по работе с миграциями-2-0.27466761671562034"},{"name":"Основные типы полей и их особенности","href":"Основы ORM в Django/ORM модели/Основные типы полей и их особенности/task.html","id":"Основные типы полей и их особенности-3-0.09323223464222963"},{"name":"Добавление данных через фикстуры","href":"Основы ORM в Django/ORM модели/Добавление данных через фикстуры/task.html","id":"Добавление данных через фикстуры-4-0.2002679569603083"}],"id":"ORM модели-1-0.515115239866544"},{"name":"CRUD операции","items":[{"name":"Чтение данных","href":"Основы ORM в Django/CRUD операции/Чтение данных/task.html","id":"Чтение данных-0-0.9273813711226655"},{"name":"Создание и обновление объектов","href":"Основы ORM в Django/CRUD операции/Создание и обновление объектов/task.html","id":"Создание и обновление объектов-1-0.15314578688594005"},{"name":"Удаление объектов","href":"Основы ORM в Django/CRUD операции/Удаление объектов/task.html","id":"Удаление объектов-2-0.696214016714547"}],"id":"CRUD операции-2-0.31146361489470986"},{"name":"Работа с админкой","items":[{"name":"Основы работы с админкой","href":"Основы ORM в Django/Работа с админкой/Основы работы с админкой/task.html","id":"Основы работы с админкой-0-0.13302263198798947"},{"name":"Настройка отображения экземпляров моделей в админ панели","href":"Основы ORM в Django/Работа с админкой/Настройка отображения экземпляров моделей в админ панели/task.html","id":"Настройка отображения экземпляров моделей в админ панели-1-0.09484035169939342"},{"name":"Основы работы с админкой","href":"Основы ORM в Django/Работа с админкой/Дополнительные настройки админки/task.html","id":"Основы работы с админкой-2-0.3622043612190393"}],"id":"Работа с админкой-3-0.7706500334529078"}],"id":"Основы ORM в Django-1-0.7109060605538842"},{"name":"Расширенные возможности ORM в Django","items":[{"name":"Введение в модуль","href":"Расширенные возможности ORM в Django/section.html","id":"Введение в модуль-0-0.4475149169710295"},{"name":"Отладка запросов","items":[{"name":"Установка и настройка Debug Toolbar","href":"Расширенные возможности ORM в Django/Отладка запросов/Установка и настройка Debug Toolbar/task.html","id":"Установка и настройка Debug Toolbar-0-0.09526314666895397"},{"name":"Практические примеры использования debugsqlshell","href":"Расширенные возможности ORM в Django/Отладка запросов/Практические примеры использования debugsqlshell/task.html","id":"Практические примеры использования debugsqlshell-1-0.16584706352823897"}],"id":"Отладка запросов-1-0.5996876618229177"},{"name":"Отношения между моделями","items":[{"name":"Отношение многие к одному","href":"Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие к одному/task.html","id":"Отношение многие к одному-0-0.15568746151419988"},{"name":"Отношение один ко многим","href":"Расширенные возможности ORM в Django/Отношения между моделями/Отношение один ко многим/task.html","id":"Отношение один ко многим-1-0.055832507039404344"},{"name":"Отношение многие ко многим","href":"Расширенные возможности ORM в Django/Отношения между моделями/Отношение многие ко многим/task.html","id":"Отношение многие ко многим-2-0.8611657572426383"}],"id":"Отношения между моделями-2-0.7854640642202562"},{"name":"Фильтрация и запросы с помощью Q-объектов","items":[{"name":"Фильтрация по полям модели и связанным моделям","href":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Фильтрация по полям модели и связанным моделям/task.html","id":"Фильтрация по полям модели и связанным моделям-0-0.44178576914219647"},{"name":"Использование Q-объектов для сложных запросов","href":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Использование Q-объектов для сложных запросов/task.html","id":"Использование Q-объектов для сложных запросов-1-0.9715466899117093"},{"name":"Группировка данных и агрегация","href":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Группировка данных и агрегация/task.html","id":"Группировка данных и агрегация-2-0.570171725166952"}],"id":"Фильтрация и запросы с помощью Q-объектов-3-0.10621014779044735"},{"name":"Оптимизация запросов","items":[{"name":"Подводные камни при работе с ORM запросами","href":"Расширенные возможности ORM в Django/Оптимизация запросов/Подводные камни при работе с ORM запросами/task.html","id":"Подводные камни при работе с ORM запросами-0-0.23981730087883113"},{"name":"Выбор полей запроса","href":"Расширенные возможности ORM в Django/Оптимизация запросов/Выбор полей запроса/task.html","id":"Выбор полей запроса-1-0.4978159460641185"},{"name":"Массовое создание и обновление","href":"Расширенные возможности ORM в Django/Оптимизация запросов/Массовое создание и обновление/task.html","id":"Массовое создание и обновление-2-0.23835736469603486"}],"id":"Оптимизация запросов-4-0.19887052513875858"}],"id":"Расширенные возможности ORM в Django-2-0.6212718340217247"},{"name":"Основы разработки REST API","items":[{"name":"Введение в модуль","href":"Основы разработки REST API/section.html","id":"Введение в модуль-0-0.8824239538854013"},{"name":"Введение в REST API","items":[{"name":"Введение в RESTful API","href":"Основы разработки REST API/Введение в REST API/Введение в RESTful API/task.html","id":"Введение в RESTful API-0-0.9815934695876314"},{"name":"Endpoint и CRUD операции в REST API","href":"Основы разработки REST API/Введение в REST API/Endpoint и CRUD операции в REST API/task.html","id":"Endpoint и CRUD операции в REST API-1-0.9074159145177185"},{"name":"Введение в Django REST Framework","href":"Основы разработки REST API/Введение в REST API/Введение в Django REST Framework/task.html","id":"Введение в Django REST Framework-2-0.7288852527816341"}],"id":"Введение в REST API-1-0.3487446930472442"},{"name":"Сериализаторы в Django REST Framework","items":[{"name":"Сериализаторы в DRF","href":"Основы разработки REST API/Сериализаторы в Django REST Framework/Сериализаторы в DRF/task.html","id":"Сериализаторы в DRF-0-0.7464624143905174"},{"name":"Модельные и вложенные сериализаторы","href":"Основы разработки REST API/Сериализаторы в Django REST Framework/Модельные и вложенные сериализаторы/task.html","id":"Модельные и вложенные сериализаторы-1-0.1934534174683531"}],"id":"Сериализаторы в Django REST Framework-2-0.35542200615861774"},{"name":"APIView в Django REST Framework","items":[{"name":"Применение статусных кодов в REST API","href":"Основы разработки REST API/APIView в Django REST Framework/Применение статусных кодов в REST API/task.html","id":"Применение статусных кодов в REST API-0-0.9087846755143927"},{"name":"Список объектов и добавление новых объектов","href":"Основы разработки REST API/APIView в Django REST Framework/Список объектов и добавление новых объектов/task.html","id":"Список объектов и добавление новых объектов-1-0.4471866690338042"},{"name":"Детальная работа с объектом","href":"Основы разработки REST API/APIView в Django REST Framework/Детальная работа с объектом/task.html","id":"Детальная работа с объектом-2-0.07738799279321973"}],"id":"APIView в Django REST Framework-3-0.458389695214904"}],"id":"Основы разработки REST API-3-0.8821834079581912"},{"name":"Тестирование и типовые API","items":[{"name":"Введение в модуль","href":"Тестирование и типовые API/section.html","id":"Введение в модуль-0-0.7626721423788172"},{"name":"Введение в тестирование","items":[{"name":"Test-Driven Development (TDD)","href":"Тестирование и типовые API/Введение в тестирование/Test-Driven Development (TDD)/task.html","id":"Test-Driven Development (TDD)-0-0.48376791730349455"},{"name":"Написание, выполнение и завершение тестов","href":"Тестирование и типовые API/Введение в тестирование/Написание, выполнение и завершение тестов/task.html","id":"Написание, выполнение и завершение тестов-1-0.25492244572160594"}],"id":"Введение в тестирование-1-0.6101523995227076"},{"name":"Тестирование в Django","items":[{"name":"Тестирование в Django","href":"Тестирование и типовые API/Тестирование в Django/Тестирование в Django/task.html","id":"Тестирование в Django-0-0.4463413100927478"}],"id":"Тестирование в Django-2-0.3638705025263709"},{"name":"Типовые (generic) API","items":[{"name":"GenericAPIView","href":"Тестирование и типовые API/Типовые (generic) API/GenericAPIView/task.html","id":"GenericAPIView-0-0.5167908329995792"},{"name":"OpenAPI документация","href":"Тестирование и типовые API/Типовые (generic) API/OpenAPI документация/task.html","id":"OpenAPI документация-1-0.376722286687595"},{"name":"Фильтрация, поиск и пагинация","href":"Тестирование и типовые API/Типовые (generic) API/Фильтрация, поиск и пагинация/task.html","id":"Фильтрация, поиск и пагинация-2-0.04683529574265033"}],"id":"Типовые (generic) API-3-0.30140239570159433"}],"id":"Тестирование и типовые API-4-0.7114267093081605"}],"base":"django-web-api"},"meta":{"metadata":[],"style":[],"script":[]},"assets":[],"headings":[{"title":"Цель урока","href":"#cel-uroka","level":2},{"title":"Применение фильтрации в запросах","href":"#primenenie-filtracii-v-zaprosah","level":2,"items":[{"title":"Пример одновременной фильтрации","href":"#primer-odnovremennoj-filtracii","level":3},{"title":"Метод exclude","href":"#metod-exclude","level":3}]},{"title":"Lookup выражения для фильтрации","href":"#lookup-vyrazheniya-dlya-filtracii","level":2,"items":[{"title":"Сравнительные lookup выражения","href":"#sravnitelnye-lookup-vyrazheniya","level":3},{"title":"Текстовый поиск","href":"#tekstovyj-poisk","level":3},{"title":"Поиск по датам и времени","href":"#poisk-po-datam-i-vremeni","level":3}]},{"title":"Фильтрация по полям связанных моделей","href":"#filtraciya-po-polyam-svyazannyh-modelej","level":2,"items":[{"title":"Основы фильтрации по связанным полям","href":"#osnovy-filtracii-po-svyazannym-polyam","level":3},{"title":"Использование обратных отношений для фильтрации","href":"#ispolzovanie-obratnyh-otnoshenij-dlya-filtracii","level":3}]}],"title":"Фильтрация по полям модели и связанным моделям","includes":[],"html":"<h2 id=\"cel-uroka\"><a href=\"#cel-uroka\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Цель урока</span></a>Цель урока</h2>\n<p>В этом уроке вы научитесь использовать мощные возможности Django ORM для фильтрации данных. Вы изучите, как применять фильтрацию к полям моделей и связанным моделям с помощью lookup выражений. Эти знания позволят вам эффективно извлекать только те данные, которые необходимы для конкретной задачи.</p>\n<h2 id=\"primenenie-filtracii-v-zaprosah\"><a href=\"#primenenie-filtracii-v-zaprosah\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Применение фильтрации в запросах</span></a>Применение фильтрации в запросах</h2>\n<p>Фильтрация данных в Django ORM позволяет эффективно извлекать записи из базы данных, соответствующие определенным критериям. Это особенно полезно, когда нужно работать с большим объемом данных и необходимо получить только те записи, которые соответствуют специфическим условиям.</p>\n<p>Допустим, есть модель <code>Book</code>, представляющая книги, с полями <code>year</code> (год издания) и <code>book_type</code> (тип книги), которая выглядит следующим образом:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span>(models.Model):\n    <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TypeChoices</span>(models.TextChoices):\n        HARDCOVER = <span class=\"hljs-string\">\"HB\"</span>, <span class=\"hljs-string\">\"Твёрдый переплёт\"</span>\n        PAPERCOVER = <span class=\"hljs-string\">\"PB\"</span>, <span class=\"hljs-string\">\"Мягкий переплёт\"</span>\n        EBOOK = <span class=\"hljs-string\">\"EB\"</span>, <span class=\"hljs-string\">\"Электронная книга\"</span>\n\n    year = models.PositiveSmallIntegerField()\n    book_type = models.CharField(max_length=<span class=\"hljs-number\">2</span>, choices=TypeChoices.choices, default=TypeChoices.PAPERCOVER)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"15\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-15\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-15\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-15.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<h3 id=\"primer-odnovremennoj-filtracii\"><a href=\"#primer-odnovremennoj-filtracii\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Пример одновременной фильтрации</span></a>Пример одновременной фильтрации</h3>\n<p>Метод <code>filter</code> в Django ORM позволяет применять фильтрацию к QuerySet'ам. Этот метод принимает аргументы, которые определяют, какие записи должны быть включены в результат запроса. Чаще всего аргументами являются условия, основанные на значениях полей моделей.</p>\n<p>Примечательно, что <code>filter</code> может принимать несколько аргументов, и все они будут автоматически сцеплены через оператор AND. Это значит, что в результат попадут только те записи, которые соответствуют всем указанным условиям одновременно.</p>\n<p>Чтобы получить все книги, изданные в 2024 году в твёрдом переплёте, следует использовать метод <code>filter</code> следующим образом:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">books = Book.objects.<span class=\"hljs-built_in\">filter</span>(year=<span class=\"hljs-number\">2024</span>, book_type=Book.TypeChoices.HARDCOVER)  <span class=\"hljs-comment\"># Условия внутри filter применяются одновременно</span>\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"28\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-28\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-28\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-28.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом примере используются два условия фильтрации: <code>year=2024</code> (год издания равен 2024) и <code>book_type=Book.TypeChoices.HARDCOVER</code> (тип книги — твёрдый переплёт). Оба условия соединены логическим И, что означает, что в результате будут возвращены только те книги, которые соответствуют сразу двум критериям.</p>\n<h3 id=\"metod-exclude\"><a href=\"#metod-exclude\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Метод exclude</span></a>Метод exclude</h3>\n<p>Метод <code>exclude</code> в Django ORM действует как антоним к методу <code>filter</code>, исключая из результатов запроса те записи, которые соответствуют указанным условиям.</p>\n<p>Допустим, нужно получить все книги, кроме тех, что изданы в 2020 году:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">books = Book.objects.exclude(year=<span class=\"hljs-number\">2020</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"41\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-41\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-41\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-41.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом запросе <code>exclude(year=2020)</code> исключает из выборки все книги, у которых год издания равен 2020.</p>\n<h2 id=\"lookup-vyrazheniya-dlya-filtracii\"><a href=\"#lookup-vyrazheniya-dlya-filtracii\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Lookup выражения для фильтрации</span></a>Lookup выражения для фильтрации</h2>\n<p>Lookup выражения в Django ORM служат для фильтрации или обращения к связанным моделям. Для их использования применяется сочетание двух подчёркиваний <strong><code>__</code></strong> для обращения к полям, связанным с текущим полем через внешние ключи, связи многие ко многим или фильтрации.</p>\n<p>Lookup выражения особенно полезны, когда требуется выполнить запросы, которые включают условия, идущие за пределы базового сравнения равенства. Они могут использоваться для фильтрации записей на основе части текста, числовых диапазонов, дат и других типов данных.</p>\n<aside>\nℹ️ Полный перечень lookup выражений можно получить в официальной [документации](https://docs.djangoproject.com/en/4.2/ref/models/querysets/#field-lookups).\n</aside>\n<h3 id=\"sravnitelnye-lookup-vyrazheniya\"><a href=\"#sravnitelnye-lookup-vyrazheniya\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Сравнительные lookup выражения</span></a>Сравнительные lookup выражения</h3>\n<p>В таблице ниже представлены выбранные сравнительные lookup выражения в Django ORM, описание их функциональности, примеры использования, а также соответствующие SQL-эквиваленты. Эти выражения демонстрируют, как различные типы сравнений могут быть применены для фильтрации данных.</p>\n<table>\n<thead>\n<tr>\n<th>Lookup выражение</th>\n<th>Описание</th>\n<th>Пример использования</th>\n<th>SQL эквивалент</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>exact</td>\n<td>Точное совпадение (используется по умолчанию)</td>\n<td>year__exact=2000</td>\n<td>WHERE year = 2000</td>\n</tr>\n<tr>\n<td>gte</td>\n<td>Больше или равно</td>\n<td>year__gte=2000</td>\n<td>WHERE year &gt;= 2000</td>\n</tr>\n<tr>\n<td>gt</td>\n<td>Больше</td>\n<td>year__gt=2000</td>\n<td>WHERE year &gt; 2000</td>\n</tr>\n<tr>\n<td>lte</td>\n<td>Меньше или равно</td>\n<td>year__lte=2000</td>\n<td>WHERE year &lt;= 2000</td>\n</tr>\n<tr>\n<td>lt</td>\n<td>Меньше</td>\n<td>year__lt=2000</td>\n<td>WHERE year &lt; 2000</td>\n</tr>\n<tr>\n<td>isnull</td>\n<td>Проверка на NULL (и на ненулевое значение)</td>\n<td>year__isnull=True year__isnull=False</td>\n<td>WHERE year IS NULL</td>\n</tr>\n<tr>\n<td>WHERE year IS NOT NULL</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>in</td>\n<td>Вхождение в перечень значений</td>\n<td>year__in=[2000, 2001, 2002]</td>\n<td>WHERE year IN (2000, 2001, 2002)</td>\n</tr>\n</tbody>\n</table>\n<p>Эти lookup выражения позволяют разработчикам Django строить сложные и точные запросы к базе данных.</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Фильтрация книг, изданных после 2000 года</span>\nBook.objects.<span class=\"hljs-built_in\">filter</span>(year__gt=<span class=\"hljs-number\">2000</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"197\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-197\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-197\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-197.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<h3 id=\"tekstovyj-poisk\"><a href=\"#tekstovyj-poisk\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Текстовый поиск</span></a>Текстовый поиск</h3>\n<p>Текстовый поиск в Django ORM предоставляет удобные инструменты для работы с текстовыми полями моделей, такими как поиск по названиям, описаниям и любым другим текстовым данным. Эти инструменты основываются на использовании специальных lookup выражений, которые преобразуются в SQL-операторы <code>LIKE</code>, <code>ILIKE</code> и регулярные выражения, позволяя выполнять поиск по тексту.</p>\n<table>\n<thead>\n<tr>\n<th>Lookup выражение</th>\n<th>Описание</th>\n<th>Пример использования</th>\n<th>SQL эквивалент</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>exact</td>\n<td>Точное совпадение (используется по умолчанию)</td>\n<td>title__exact=\"Python\"</td>\n<td>WHERE title = 'Python'</td>\n</tr>\n<tr>\n<td>contains</td>\n<td>Содержит подстроку</td>\n<td>title__contains=\"Python\"</td>\n<td>WHERE title LIKE '%Python%'</td>\n</tr>\n<tr>\n<td>startswith</td>\n<td>Начинается с подстроки</td>\n<td>title__startswith=\"Python\"</td>\n<td>WHERE title LIKE 'Python%'</td>\n</tr>\n<tr>\n<td>endswith</td>\n<td>Заканчивается подстрокой</td>\n<td>title__endswith=\"tutorial\"</td>\n<td>WHERE title LIKE '%tutorial'</td>\n</tr>\n<tr>\n<td>regex</td>\n<td>Регулярное выражение</td>\n<td>title__regex=r\"^Python\\w+\"</td>\n<td>WHERE title REGEXP '^Python\\w+'</td>\n</tr>\n</tbody>\n</table>\n<aside>\n💡 Версии с префиксом `i`, такие как `iexact`, `icontains`, `istartswith`, `iendswith` и `iregex`, позволяют выполнить поиск без учета регистра символов, используя SQL-оператор `ILIKE` и регулярные выражения, нечувствительные к регистру.\n</aside>\n<p><strong>Фильтрация книг по названию, точно совпадающему с \"Python\":</strong></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">Book.objects.<span class=\"hljs-built_in\">filter</span>(title=<span class=\"hljs-string\">\"Python\"</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"299\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-299\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-299\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-299.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p><strong>Поиск книг, описание которых содержит слово \"Python\", нечувствительно к регистру:</strong></p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\">Book.objects.<span class=\"hljs-built_in\">filter</span>(description__icontains=<span class=\"hljs-string\">\"python\"</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"303\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-303\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-303\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-303.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<h3 id=\"poisk-po-datam-i-vremeni\"><a href=\"#poisk-po-datam-i-vremeni\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Поиск по датам и времени</span></a>Поиск по датам и времени</h3>\n<p>Lookup выражения также предназначены для фильтрации записей по дате и времени. С их помощью можно легко фильтровать записи по определенным <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/querysets/#date\" target=\"_blank\" rel=\"noreferrer noopener\">датам</a>, <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/querysets/#range\" target=\"_blank\" rel=\"noreferrer noopener\">диапазонам</a>, а также извлекать и сравнивать отдельные части даты, например, <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/querysets/#year\" target=\"_blank\" rel=\"noreferrer noopener\">год</a>, <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/querysets/#month\" target=\"_blank\" rel=\"noreferrer noopener\">месяц</a>, или <a href=\"https://docs.djangoproject.com/en/4.2/ref/models/querysets/#day\" target=\"_blank\" rel=\"noreferrer noopener\">день</a>. Это особенно полезно для аналитики и отчетности, где временные рамки имеют большое значение. За подробной информацией следует обращаться к документации.</p>\n<p>Следует помнить, что возможности и SQL синтаксис работы с датой и временем могут отличаться в зависимости от используемой СУБД.</p>\n<h2 id=\"filtraciya-po-polyam-svyazannyh-modelej\"><a href=\"#filtraciya-po-polyam-svyazannyh-modelej\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Фильтрация по полям связанных моделей</span></a>Фильтрация по полям связанных моделей</h2>\n<p>Фильтрация по полям связанных моделей в Django ORM позволяет использовать отношения между моделями для извлечения данных, соответствующих определенным критериям. Это инструмент, который расширяет возможности фильтрации за пределы одной модели, позволяя проводить сложные запросы через связанные поля.</p>\n<h3 id=\"osnovy-filtracii-po-svyazannym-polyam\"><a href=\"#osnovy-filtracii-po-svyazannym-polyam\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Основы фильтрации по связанным полям</span></a>Основы фильтрации по связанным полям</h3>\n<p>Использование двойного подчеркивания (<code>__</code>) в Django ORM позволяет указывать пути через связанные поля моделей для фильтрации. Это означает, что вы можете фильтровать объекты одной модели, основываясь на атрибутах связанных моделей.</p>\n<p>Допустим, у нас есть две модели: <code>Category</code> и <code>Book</code>, где каждая книга связана с определенной категорией через поле <code>ForeignKey</code>.</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-keyword\">from</span> django.db <span class=\"hljs-keyword\">import</span> models\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Category</span>(models.Model):\n    name = models.CharField(max_length=<span class=\"hljs-number\">100</span>)\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Book</span>(models.Model):\n    title = models.CharField(max_length=<span class=\"hljs-number\">100</span>)\n    category = models.ForeignKey(Category, on_delete=models.CASCADE, related_name=<span class=\"hljs-string\">'books'</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"328\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-328\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-328\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-328.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>Для фильтрации книг из определенной категории мы можем использовать имя категории как фильтр:</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Получение всех книг категории \"Программирование\"</span>\nBook.objects.<span class=\"hljs-built_in\">filter</span>(category__name=<span class=\"hljs-string\">\"Программирование\"</span>)\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"332\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-332\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-332\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-332.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом примере <code>category__name=\"Программирование\"</code> указывает Django ORM фильтровать объекты <code>Book</code>, у которых связанный объект <code>Category</code> имеет поле <code>name</code> со значением \"Программирование\". Здесь <code>category__name</code> использует двойное подчеркивание для указания связи между моделями и поля, по которому выполняется фильтрация.</p>\n<h3 id=\"ispolzovanie-obratnyh-otnoshenij-dlya-filtracii\"><a href=\"#ispolzovanie-obratnyh-otnoshenij-dlya-filtracii\" class=\"yfm-anchor\" aria-hidden=\"true\"><span class=\"visually-hidden\">Использование обратных отношений для фильтрации</span></a>Использование обратных отношений для фильтрации</h3>\n<p>Чтобы фильтровать категории книг на основе даты выпуска книг, можно использовать следующий запрос. Этот запрос вернет все категории, которые содержат хотя бы одну книгу, выпущенную до определенного года.</p>\n<p>В этом примере необходимо найти категории книг, в которых есть книги, выпущенные в 2023 году или позже.</p>\n\n    <div class=\"yfm-clipboard\">\n    <pre><code class=\"hljs python\"><span class=\"hljs-comment\"># Получаем QuerySet категорий, в которых есть книги, выпущенные в 2023 году или позже</span>\ncategories_with_old_books = Category.objects.<span class=\"hljs-built_in\">filter</span>(books__year__lt=<span class=\"hljs-number\">2000</span>).distinct()\n</code></pre>\n\n    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" class=\"yfm-clipboard-button\" data-animation=\"345\">\n        <path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path>\n        <path stroke=\"currentColor\" fill=\"transparent\" stroke-width=\"1.5\" d=\"M9.5 13l3 3l5 -5\" visibility=\"hidden\">\n            <animate id=\"visibileAnimation-345\" attributeName=\"visibility\" from=\"hidden\" to=\"visible\" dur=\"0.2s\" fill=\"freeze\" begin></animate>\n            <animate id=\"hideAnimation-345\" attributeName=\"visibility\" from=\"visible\" to=\"hidden\" dur=\"1s\" begin=\"visibileAnimation-345.end+1\" fill=\"freeze\"></animate>\n        </path>\n    </svg>\n    </div>\n<p>В этом запросе:</p>\n<ul>\n<li><code>Category.objects.filter()</code> используется для получения QuerySet категорий.</li>\n<li><code>books__year__gte=2023</code> использует двойное подчеркивание дважды: первый раз для обращения к связанным объектам книг (<code>books</code>) через <code>related_name</code>, указанный в модели <code>Book</code>, и второй раз для фильтрации по полю <code>year</code> книг, чтобы проверить, выпущены ли они в определённые года (<code>year__gte=2023</code>).</li>\n<li><code>.distinct()</code> применяется к результату, чтобы убедиться, что категории не дублируются в списке результатов, если в одной категории есть несколько книг, выпущенных в указанные года.</li>\n</ul>\n"},"router":{"pathname":"Расширенные возможности ORM в Django/Фильтрация и запросы с помощью Q-объектов/Фильтрация по полям модели и связанным моделям/task.html"},"lang":"ru","langs":["ru"]};
                </script>
                <script type="application/javascript" src="../_bundle/react.js"></script>
<script type="application/javascript" src="../_bundle/app.js"></script>
<script type="application/javascript" src="../_bundle/vendor.js"></script>
            </body>
        </html>
    